<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PET SOUNDS - Traduttore per Animali Domestici</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-glow: #FF6B6B;
            --secondary-glow: #4ECDC4;
            --accent-glow: #FFE66D;
            --dark-bg: #1A0033;
            --medium-bg: #2C0059;
            --light-text: #E0E0E0;
            --dark-text: #0A001A;
            --panel-bg-alpha: rgba(44, 0, 89, 0.7);
            --border-glow: 2px solid rgba(255,255,255,0.2);
            --text-shadow-light: 0 0 8px rgba(255,255,255,0.5);
            --text-shadow-dark: 0 0 8px rgba(0,0,0,0.5);
        }
        
        /* Stili globali con miglioramenti responsive */
        body {
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            padding: 0;
            background: radial-gradient(circle at 50% 50%, var(--medium-bg) 0%, var(--dark-bg) 100%);
            min-height: 100vh;
            color: var(--light-text);
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            animation: backgroundShift 30s infinite alternate ease-in-out;
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }
        
        /* Contenitore principale adattivo */
        .app-container {
            max-width: 1200px;
            width: 95%;
            margin: 20px auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            position: relative;
            z-index: 1;
            padding: 15px;
        }

        @media (min-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }
        
        @media (min-width: 992px) {
            .app-container {
                grid-template-columns: 1.5fr 1fr;
                gap: 40px;
                margin: 40px auto;
                padding: 20px;
            }
        }
        
        /* Stili dell'intestazione */
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 20px;
            animation: headerGlow 8s infinite alternate ease-in-out;
        }

        @keyframes headerGlow {
            0% { text-shadow: 0 0 10px var(--primary-glow), 0 0 20px var(--primary-glow); }
            50% { text-shadow: 0 0 20px var(--secondary-glow), 0 0 40px var(--secondary-glow); }
            100% { text-shadow: 0 0 10px var(--primary-glow), 0 0 20px var(--primary-glow); }
        }
        
        /* Titolo principale con adattamento dimensionale */
        h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 2.8rem;
            color: white;
            margin: 10px 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            line-height: 1.2;
        }
        
        @media (min-width: 480px) {
            h1 { font-size: 3.5rem; }
        }
        
        @media (min-width: 768px) {
            h1 { font-size: 4rem; }
        }
        
        @media (min-width: 992px) {
            h1 { font-size: 4.5rem; }
        }
        
        /* Tagline responsive */
        .tagline {
            font-size: 1.2rem;
            color: var(--light-text);
            text-shadow: var(--text-shadow-light);
            font-weight: 300;
            line-height: 1.4;
            padding: 0 15px;
        }
        
        @media (min-width: 768px) {
            .tagline { font-size: 1.4rem; }
        }
        
        @media (min-width: 992px) {
            .tagline { font-size: 1.6rem; }
        }
        
        /* Pannelli principali con layout adattivo */
        .main-panel, .leaderboard {
            background: var(--panel-bg-alpha);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 0 25px rgba(78,205,196,0.3), inset 0 0 10px rgba(78,205,196,0.1);
            backdrop-filter: blur(15px);
            border: var(--border-glow);
            transition: all 0.4s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .main-panel, .leaderboard {
                padding: 30px;
                border-radius: 35px;
            }
        }
        
        @media (min-width: 992px) {
            .main-panel, .leaderboard {
                padding: 40px;
                border-radius: 40px;
            }
        }
        
        .main-panel:hover, .leaderboard:hover {
            box-shadow: 0 0 35px rgba(78,205,196,0.5), inset 0 0 15px rgba(78,205,196,0.2);
            transform: translateY(-5px) scale(1.01);
        }

        /* Sezione Avatar Centrale - completamente adattiva */
        .pet-display-section {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--panel-bg-alpha);
            border-radius: 30px;
            box-shadow: 0 0 25px rgba(255,107,107,0.3), inset 0 0 10px rgba(255,107,107,0.1);
            border: var(--border-glow);
            transition: all 0.4s ease-in-out;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .pet-display-section {
                padding: 25px;
                border-radius: 35px;
            }
        }
        
        @media (min-width: 992px) {
            .pet-display-section {
                padding: 30px;
                border-radius: 40px;
                margin-bottom: 0;
            }
        }
        
        .pet-display {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        @media (min-width: 480px) {
            .pet-display {
                width: 280px;
                height: 280px;
            }
        }
        
        @media (min-width: 768px) {
            .pet-display {
                width: 320px;
                height: 320px;
                margin-bottom: 40px;
            }
        }
        
        @media (min-width: 992px) {
            .pet-display {
                width: 350px;
                height: 350px;
            }
        }
        
        .pet-avatar {
            width: 90%;
            height: 90%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            border: 3px solid var(--primary-glow);
            box-shadow: 0 0 30px var(--primary-glow), inset 0 0 15px var(--primary-glow);
            position: relative;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            animation: pulseGlow 4s infinite alternate ease-in-out;
        }

        @media (min-width: 480px) {
            .pet-avatar {
                border-width: 4px;
            }
        }
        
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 30px var(--primary-glow), inset 0 0 15px var(--primary-glow); }
            50% { box-shadow: 0 0 50px var(--secondary-glow), inset 0 0 25px var(--secondary-glow); }
            100% { box-shadow: 0 0 30px var(--primary-glow), inset 0 0 15px var(--primary-glow); }
        }

        .pet-avatar.bounce { animation: avatarBounce 0.6s ease-out; }
        @keyframes avatarBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .pet-avatar.wiggle { animation: avatarWiggle 0.4s ease-in-out; }
        @keyframes avatarWiggle { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(8deg); } 75% { transform: rotate(-8deg); } }
        
        .pet-core, .pet-aura {
            position: absolute;
            border-radius: 50%;
            transition: all 0.5s ease-in-out;
        }
        .pet-core {
            width: 60%;
            height: 60%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            box-shadow: 0 0 20px var(--accent-glow);
            animation: corePulse 3s infinite alternate ease-in-out;
        }
        .pet-aura {
            width: 90%;
            height: 90%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 70%);
            border: 1px dashed rgba(255,255,255,0.3);
            animation: auraRotate 15s infinite linear;
        }

        @keyframes corePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        @keyframes auraRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #audioVisualizer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        #audioVisualizer.active {
            opacity: 1;
        }

        /* Controlli adattivi */
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        @media (min-width: 992px) {
            .controls-panel {
                gap: 30px;
            }
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        @media (min-width: 768px) {
            .button-group {
                gap: 20px;
            }
        }
        
        button {
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            color: var(--dark-text);
            border: none;
            padding: 16px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(255,107,107,0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-transform: uppercase;
            width: 100%;
            max-width: 350px;
        }
        
        @media (min-width: 480px) {
            button {
                font-size: 1.2rem;
                padding: 18px 35px;
            }
        }
        
        @media (min-width: 768px) {
            button {
                font-size: 1.3rem;
                padding: 20px 40px;
            }
        }
        
        button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(45deg);
            opacity: 0;
            transition: opacity 0.4s ease, transform 0.4s ease;
            z-index: -1;
        }
        
        button:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 0 25px rgba(255,107,107,0.7);
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 0 0 10px rgba(255,107,107,0.4);
        }
        
        button:disabled {
            background: #444;
            box-shadow: none;
            transform: none !important;
            cursor: not-allowed;
            opacity: 0.6;
            color: #888;
        }

        #retryMicButton {
            background: linear-gradient(45deg, #FFE66D, #FFD93D);
            color: var(--dark-text);
            box-shadow: 0 0 15px rgba(255,230,109,0.5);
            margin-top: 10px;
        }

        #retryMicButton:hover {
            box-shadow: 0 0 25px rgba(255,230,109,0.7);
        }
        
        /* Opzioni voce adattive */
        .voice-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        @media (min-width: 480px) {
            .voice-options {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .voice-options {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }
        
        @media (min-width: 992px) {
            .voice-options {
                grid-template-columns: repeat(6, 1fr);
                gap: 15px;
            }
        }
        
        .voice-option input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .voice-option label {
            display: block;
            padding: 12px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            cursor: pointer;
            box-shadow: inset 0 0 8px rgba(255,255,255,0.1);
            transition: all 0.3s ease-out;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.3);
            color: var(--light-text);
            text-shadow: var(--text-shadow-light);
            text-align: center;
            font-size: 0.9rem;
        }
        
        @media (min-width: 480px) {
            .voice-option label {
                padding: 14px 20px;
                font-size: 1rem;
            }
        }
        
        .voice-option input:checked + label {
            background: var(--accent-glow);
            border-color: var(--primary-glow);
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--accent-glow), inset 0 0 8px rgba(255,255,255,0.5);
            color: var(--dark-text);
            text-shadow: var(--text-shadow-dark);
        }
        
        .voice-option label:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 10px rgba(255,255,255,0.3), inset 0 0 5px rgba(255,255,255,0.2);
        }
        
        /* Contenitore traduzione adattivo */
        .translation-container {
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            padding: 20px;
            min-height: 120px;
            margin: 20px 0;
            box-shadow: inset 0 0 15px rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.4);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        @media (min-width: 768px) {
            .translation-container {
                padding: 25px;
                min-height: 140px;
            }
        }
        
        #translation {
            font-family: 'Fredoka One', cursive;
            font-size: 1.6rem;
            text-align: center;
            margin: auto;
            color: var(--light-text);
            line-height: 1.3;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: var(--text-shadow-light);
            padding: 10px;
        }
        
        @media (min-width: 480px) {
            #translation {
                font-size: 1.8rem;
            }
        }
        
        @media (min-width: 768px) {
            #translation {
                font-size: 2rem;
            }
        }
        
        @media (min-width: 992px) {
            #translation {
                font-size: 2.2rem;
            }
        }
        
        .translation-meta {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
            margin-top: 15px;
            text-align: right;
            font-weight: 300;
        }
        
        @media (min-width: 768px) {
            .translation-meta {
                font-size: 0.9rem;
            }
        }
        
        /* Controlli audio adattivi */
        .audio-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (min-width: 480px) {
            .audio-controls {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .audio-controls button {
            padding: 14px 20px;
            font-size: 1rem;
            border-radius: 40px;
        }
        
        @media (min-width: 480px) {
            .audio-controls button {
                padding: 14px 20px;
                font-size: 1.1rem;
            }
        }
        
        @media (min-width: 768px) {
            .audio-controls button {
                padding: 15px 25px;
                font-size: 1.2rem;
            }
        }
        
        #shareAudio {
            background: linear-gradient(45deg, #4ECDC4, #6DE7B8);
            box-shadow: 0 0 15px rgba(78,205,196,0.5);
        }
        
        #shareAudio:hover {
            box-shadow: 0 0 25px rgba(78,205,196,0.7);
        }

        #shareImage {
            background: linear-gradient(45deg, #FFE66D, #FFD93D);
            color: var(--dark-text);
            box-shadow: 0 0 15px rgba(255,230,109,0.5);
        }

        #shareImage:hover {
            box-shadow: 0 0 25px rgba(255,230,109,0.7);
        }
        
        #download {
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            box-shadow: 0 0 15px rgba(255,107,107,0.5);
        }
        
        #download:hover {
            box-shadow: 0 0 25px rgba(255,107,107,0.7);
        }
        
        /* Indicatore di caricamento */
        #loading-indicator {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            color: var(--light-text);
            display: none;
            font-weight: 500;
            text-shadow: var(--text-shadow-light);
        }
        
        @media (min-width: 768px) {
            #loading-indicator {
                font-size: 1.4rem;
            }
        }
        
        #loading-indicator.show {
            display: block;
            animation: pulse 1.5s infinite;
        }
        
        /* Sezione classifica adattiva */
        .leaderboard {
            grid-column: 1 / -1;
            background: var(--panel-bg-alpha);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 0 25px rgba(255,107,107,0.3), inset 0 0 10px rgba(255,107,107,0.1);
            border: var(--border-glow);
            position: relative;
        }

        @media (min-width: 992px) {
            .leaderboard {
                grid-column: 2 / 3;
                margin-top: 0;
            }
        }
        
        .leaderboard h2 {
            font-family: 'Fredoka One', cursive;
            color: var(--primary-glow);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
            text-shadow: 0 0 12px var(--primary-glow);
        }
        
        @media (min-width: 768px) {
            .leaderboard h2 {
                font-size: 2.2rem;
            }
        }
        
        #leaderboard-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-glow) rgba(255,255,255,0.1);
        }

        @media (min-width: 768px) {
            #leaderboard-list {
                max-height: 400px;
            }
        }
        
        #leaderboard-list::-webkit-scrollbar { width: 8px; }
        #leaderboard-list::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 8px; }
        #leaderboard-list::-webkit-scrollbar-thumb { background: var(--secondary-glow); border-radius: 8px; border: 2px solid rgba(255,255,255,0.2); }
        
        #leaderboard-list li {
            padding: 15px 20px;
            margin-bottom: 12px;
            background: rgba(255,255,255,0.08);
            border-radius: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-glow);
            transition: all 0.3s ease-out;
            font-weight: 400;
            line-height: 1.5;
            color: var(--light-text);
            text-shadow: var(--text-shadow-light);
            font-size: 0.9rem;
        }
        
        @media (min-width: 480px) {
            #leaderboard-list li {
                padding: 16px 22px;
                font-size: 1rem;
            }
        }
        
        #leaderboard-list li:hover {
            transform: translateX(8px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            border-left-color: var(--secondary-glow);
            background: rgba(255,255,255,0.15);
        }
        
        /* Informazioni utente adattiva */
        .user-info {
            text-align: center;
            margin-top: 20px;
            font-size: 1rem;
            color: var(--light-text);
            font-weight: 300;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 18px;
            box-shadow: inset 0 0 8px rgba(255,255,255,0.05);
            text-shadow: var(--text-shadow-light);
        }
        
        @media (min-width: 768px) {
            .user-info {
                margin-top: 30px;
                font-size: 1.1rem;
            }
        }
        
        /* Selettore lingua adattivo */
        .language-selector {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 10px 15px;
            border-radius: 25px;
            border: 2px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.15);
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px 16px;
            padding-right: 40px;
            text-shadow: var(--text-shadow-light);
            font-size: 0.85rem;
            max-width: 200px;
        }
        
        @media (min-width: 480px) {
            .language-selector {
                top: 20px;
                right: 20px;
                padding: 12px 18px;
                font-size: 0.9rem;
                max-width: 220px;
            }
        }
        
        @media (min-width: 768px) {
            .language-selector {
                top: 25px;
                right: 25px;
                padding: 12px 20px;
                font-size: 1rem;
                max-width: 240px;
            }
        }
        
        .language-selector:hover {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
        }
        
        /* Sfondo con particelle */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.2)"/></svg>') repeat;
            background-size: 20px 20px;
            animation: particleFlow 60s linear infinite;
        }

        @keyframes particleFlow {
            from { background-position: 0 0; }
            to { background-position: 100px 100px; }
        }
        
        /* Bolla di dialogo adattiva */
        .speech-bubble {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 0 15px rgba(255,255,255,0.5), inset 0 0 8px rgba(255,255,255,0.2);
            font-size: 1rem;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            white-space: nowrap;
            z-index: 10;
            font-family: 'Fredoka One', cursive;
            color: var(--dark-text);
            text-shadow: none;
            max-width: 300px;
            text-align: center;
            white-space: normal;
            word-break: break-word;
        }
        
        @media (min-width: 480px) {
            .speech-bubble {
                top: -65px;
                font-size: 1.1rem;
                max-width: 350px;
            }
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 12px 12px 0;
            border-style: solid;
            border-color: rgba(255,255,255,0.95) transparent transparent;
        }
        
        .speech-bubble.show {
            opacity: 1;
            top: -80px;
        }

        /* Indicatore stato microfono */
        #mic-status {
            margin-top: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--light-text);
            text-shadow: var(--text-shadow-light);
            min-height: 20px;
            display: block;
        }
        
        @media (min-width: 768px) {
            #mic-status {
                font-size: 1rem;
            }
        }

        #mic-status.ready { color: var(--secondary-glow); }
        #mic-status.denied, #mic-status.blocked { color: var(--primary-glow); }
        
        /* Modal adattivo */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--panel-bg-alpha);
            border-radius: 18px;
            padding: 30px;
            box-shadow: 0 0 35px rgba(78,205,196,0.5), inset 0 0 15px rgba(78,205,196,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            text-align: center;
            max-width: 90%;
            width: 100%;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

        @media (min-width: 480px) {
            .modal-content {
                padding: 35px;
                border-radius: 20px;
                max-width: 450px;
            }
        }
        
        .modal-overlay.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-content h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            color: var(--primary-glow);
            margin-bottom: 15px;
            text-shadow: 0 0 8px var(--primary-glow);
        }
        
        @media (min-width: 480px) {
            .modal-content h3 {
                font-size: 2rem;
            }
        }

        .modal-content p {
            font-size: 1rem;
            color: var(--light-text);
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        @media (min-width: 480px) {
            .modal-content p {
                font-size: 1.1rem;
            }
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        @media (min-width: 480px) {
            .modal-buttons {
                flex-direction: row;
                justify-content: center;
                gap: 20px;
            }
        }

        .modal-buttons button {
            padding: 12px 20px;
            font-size: 1rem;
            border-radius: 30px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        @media (min-width: 480px) {
            .modal-buttons button {
                padding: 12px 25px;
                font-size: 1.1rem;
            }
        }

        .modal-buttons button.confirm {
            background: linear-gradient(45deg, #4ECDC4, #6DE7B8);
            color: var(--dark-text);
        }

        .modal-buttons button.cancel {
            background: rgba(255,255,255,0.1);
            color: var(--light-text);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: none;
        }

        .modal-buttons button.cancel:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        /* Indicatore di dispositivo */
        .device-indicator {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            opacity: 0.7;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <select class="language-selector" id="language-selector">
        <option value="en">English</option>
        <option value="it" selected>Italiano</option>
        <option value="es">Espa√±ol</option>
        <option value="fr">Fran√ßais</option>
        <option value="de">Deutsch</option>
        <option value="pt">Portugu√™s</option>
    </select>
    
    <div class="app-container">
        <div class="header">
            <h1>üêæ PET SOUNDS üêæ</h1>
            <div class="tagline">Scopri cosa dice veramente il tuo animale!</div>
        </div>
        
        <div class="pet-display-section">
            <div class="pet-display">
                <div class="pet-avatar" id="pet-avatar">
                    <div class="pet-core" id="petCore"></div>
                    <div class="pet-aura" id="petAura"></div>
                    <canvas id="audioVisualizer"></canvas>
                    <div class="speech-bubble" id="speechBubble"></div>
                </div>
            </div>
            <div class="user-info">
                <span>Il tuo ID utente:</span> <span id="user-id-display">user-8d3f7a</span>
            </div>
        </div>

        <div class="main-panel controls-panel">
            <div class="button-group">
                <button id="record">üé§ Registra Suoni Animale</button>
                <button id="stop" disabled>‚èπ Ferma Registrazione</button>
                <span id="mic-status">Microfono pronto!</span>
                <button id="retryMicButton" style="display:none;">Riprova Microfono</button>
            </div>
            
            <div class="voice-options">
                <div class="voice-option">
                    <input type="radio" id="normal" name="voice" value="normal" checked>
                    <label for="normal">Normale</label>
                </div>
                <div class="voice-option">
                    <input type="radio" id="chipmunk" name="voice" value="chipmunk">
                    <label for="chipmunk">Chipmunk</label>
                </div>
                <div class="voice-option">
                    <input type="radio" id="demon" name="voice" value="demon">
                    <label for="demon">Demone</label>
                </div>
                <div class="voice-option">
                    <input type="radio" id="robot" name="voice" value="robot">
                    <label for="robot">Robot</label>
                </div>
                <div class="voice-option">
                    <input type="radio" id="echo" name="voice" value="echo">
                    <label for="echo">Eco</label>
                </div>
                <div class="voice-option">
                    <input type="radio" id="reverb" name="voice" value="reverb">
                    <label for="reverb">Riverbero</label>
                </div>
            </div>
            
            <div class="translation-container">
                <div id="translation">Premi il pulsante di registrazione e lascia che il tuo animale parli!</div>
                <div class="translation-meta" id="translationMeta"></div>
            </div>
            
            <div id="loading-indicator">
                <span>Analizzando i suoni dell'animale...</span> üêæ
            </div>
            
            <div class="audio-controls">
                <button id="shareAudio" disabled>üì± Condividi Audio</button>
                <button id="shareImage" disabled>üñºÔ∏è Condividi Immagine</button>
                <button id="download" disabled>üíæ Scarica Audio</button>
            </div>
        </div>
        
        <div class="leaderboard">
            <h2>Ultime Traduzioni</h2>
            <ul id="leaderboard-list">
                <li>
                    <strong>"Voglio le crocchette extra subito! üçñ"</strong>
                    <div class="translation-meta">
                        üê± ‚Ä¢ 16/07/2025, 15:30:23 ‚Ä¢ Tu
                    </div>
                </li>
                <li>
                    <strong>"Ho visto un uccello fuori dalla finestra! üê¶"</strong>
                    <div class="translation-meta">
                        üê± ‚Ä¢ 16/07/2025, 14:22:11 ‚Ä¢ user-9b3c7d
                    </div>
                </li>
                <li>
                    <strong>"√à ora di giocare! Lancia la palla! üéæ"</strong>
                    <div class="translation-meta">
                        üê∂ ‚Ä¢ 16/07/2025, 13:45:56 ‚Ä¢ user-4a2f1e
                    </div>
                </li>
                <li>
                    <strong>"Accarezzami proprio qui... ah s√¨! üòª"</strong>
                    <div class="translation-meta">
                        üê± ‚Ä¢ 16/07/2025, 12:30:44 ‚Ä¢ Tu
                    </div>
                </li>
                <li>
                    <strong>"Ho fame! Dove sono i miei biscotti? üç™"</strong>
                    <div class="translation-meta">
                        üê∂ ‚Ä¢ 16/07/2025, 11:15:32 ‚Ä¢ user-6e5d8c
                    </div>
                </li>
            </ul>
        </div>
    </div>
    
    <audio id="playback" controls class="hidden"></audio>

    <div class="modal-overlay" id="permissionModal">
        <div class="modal-content">
            <h3>Permesso Microfono Richiesto</h3>
            <p>Per tradurre i suoni del tuo animale, "PET SOUNDS" ha bisogno dell'accesso al tuo microfono. Clicca "Consenti" per procedere.</p>
            <div class="modal-buttons">
                <button class="confirm" id="allowMic">Consenti</button>
                <button class="cancel" id="denyMic">Nega</button>
            </div>
        </div>
    </div>
    
    <div class="device-indicator" id="deviceIndicator"></div>
    
    <script>
        class PetVoiceTranslator {
            constructor() {
                this.audioContext = null;
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.audioBlob = null;
                this.audioBuffer = null;
                this.analyserNode = null;
                this.petType = 'cat';
                this.currentVoice = 'normal';
                this.emotionalState = 'normal';
                this.translations = [];
                this.userId = 'user-' + Math.random().toString(36).substr(2, 6);
                this.animationFrameId = null;
                
                this.initElements();
                this.initEventListeners();
                this.initParticles();
                this.updatePetAvatar();
                this.resizeCanvas();
                this.updateDeviceIndicator();
                
                document.getElementById('user-id-display').textContent = this.userId;
            }

            initElements() {
                this.recordButton = document.getElementById('record');
                this.stopButton = document.getElementById('stop');
                this.playbackElement = document.getElementById('playback');
                this.translationElement = document.getElementById('translation');
                this.translationMetaElement = document.getElementById('translationMeta');
                this.shareAudioButton = document.getElementById('shareAudio');
                this.shareImageButton = document.getElementById('shareImage');
                this.downloadButton = document.getElementById('download');
                this.loadingIndicator = document.getElementById('loading-indicator');
                this.leaderboardList = document.getElementById('leaderboard-list');
                this.petAvatar = document.getElementById('pet-avatar');
                this.speechBubble = document.getElementById('speechBubble');
                this.petCore = document.getElementById('petCore');
                this.petAura = document.getElementById('petAura');
                this.audioVisualizerCanvas = document.getElementById('audioVisualizer');
                this.audioVisualizerCtx = this.audioVisualizerCanvas.getContext('2d');
                this.permissionModal = document.getElementById('permissionModal');
                this.allowMicButton = document.getElementById('allowMic');
                this.denyMicButton = document.getElementById('denyMic');
                this.micStatusElement = document.getElementById('mic-status');
                this.retryMicButton = document.getElementById('retryMicButton');
                this.deviceIndicator = document.getElementById('deviceIndicator');
            }
            
            initEventListeners() {
                this.recordButton.addEventListener('click', () => this.handleRecordClick());
                this.stopButton.addEventListener('click', () => this.stopRecording());
                this.shareAudioButton.addEventListener('click', () => this.shareAudio());
                this.shareImageButton.addEventListener('click', () => this.shareImage());
                this.downloadButton.addEventListener('click', () => this.downloadAudio());

                this.allowMicButton.addEventListener('click', () => this.requestMicrophonePermission(true));
                this.denyMicButton.addEventListener('click', () => this.requestMicrophonePermission(false));
                this.retryMicButton.addEventListener('click', () => this.handleRecordClick());
                
                document.querySelectorAll('input[name="voice"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.currentVoice = e.target.value;
                        this.updatePetAvatar();
                    });
                });

                window.addEventListener('resize', () => {
                    this.resizeCanvas();
                    this.updateDeviceIndicator();
                });
            }
            
            // Aggiorna l'indicatore del tipo di dispositivo
            updateDeviceIndicator() {
                let deviceType = 'Desktop';
                if (window.innerWidth < 768) {
                    deviceType = 'Mobile';
                } else if (window.innerWidth < 992) {
                    deviceType = 'Tablet';
                }
                
                const orientation = window.innerWidth > window.innerHeight ? 'Landscape' : 'Portrait';
                this.deviceIndicator.textContent = `${deviceType} | ${orientation} | ${window.innerWidth}√ó${window.innerHeight}`;
            }

            resizeCanvas() {
                if (this.audioVisualizerCanvas) {
                    this.audioVisualizerCanvas.width = this.audioVisualizerCanvas.offsetWidth;
                    this.audioVisualizerCanvas.height = this.audioVisualizerCanvas.offsetHeight;
                }
            }
            
            initParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = window.innerWidth < 768 ? 20 : 30;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.style.position = 'absolute';
                    const size = Math.random() * 8 + 3;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.background = `rgba(255,255,255,${Math.random() * 0.4 + 0.1})`;
                    particle.style.borderRadius = '50%';
                    particle.style.top = `${Math.random() * 100}%`;
                    particle.style.left = `${Math.random() * 100}%`;
                    
                    const duration = Math.random() * 25 + 10;
                    particle.style.animation = `float ${duration}s linear infinite`;
                    particle.style.animationDelay = `${Math.random() * 5}s`;
                    
                    particlesContainer.appendChild(particle);
                }
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes float {
                        0% { transform: translateY(0) translateX(0); opacity: 0; }
                        10% { opacity: 1; }
                        90% { opacity: 1; }
                        100% { transform: translateY(-100vh) translateX(${Math.random() > 0.5 ? '-' : ''}20vw); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            async handleRecordClick() {
                this.recordButton.disabled = true;
                this.retryMicButton.style.display = 'none';

                try {
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        this.startRecording();
                    } else {
                        this.translationElement.textContent = 'Il tuo browser non supporta la registrazione audio';
                    }
                } catch (error) {
                    console.error('Errore nella richiesta del microfono:', error);
                    this.translationElement.textContent = 'Impossibile accedere al microfono. Controlla i permessi.';
                    this.recordButton.disabled = false;
                }
            }

            async requestMicrophonePermission(allow) {
                this.permissionModal.classList.remove('show');

                if (allow) {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        this.startRecording(stream);
                    } catch (error) {
                        console.error('Errore nell\'accesso al microfono:', error);
                        this.translationElement.textContent = 'Accesso al microfono negato.';
                        this.recordButton.disabled = false;
                    }
                } else {
                    this.translationElement.textContent = 'Accesso al microfono negato.';
                    this.recordButton.disabled = false;
                }
            }
            
            async startRecording(stream = null) {
                try {
                    this.audioChunks = [];
                    this.translationElement.textContent = 'In ascolto del tuo animale...';
                    this.translationMetaElement.textContent = "";
                    this.playbackElement.classList.add('hidden');
                    this.shareAudioButton.disabled = true;
                    this.shareImageButton.disabled = true;
                    this.downloadButton.disabled = true;
                    this.retryMicButton.style.display = 'none';

                    this.petAvatar.classList.add('bounce');
                    
                    if (!stream) {
                        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    }

                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    this.analyserNode = this.audioContext.createAnalyser();
                    this.analyserNode.fftSize = 2048;
                    const source = this.audioContext.createMediaStreamSource(stream);
                    source.connect(this.analyserNode);
                    
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = async () => {
                        cancelAnimationFrame(this.animationFrameId);
                        this.audioVisualizerCanvas.classList.remove('active');
                        this.loadingIndicator.classList.add('show');
                        this.audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                        
                        this.audioBuffer = await this.audioContext.decodeAudioData(await this.audioBlob.arrayBuffer());
                        
                        await this.processAudio();
                        
                        this.playbackElement.src = URL.createObjectURL(this.audioBlob);
                        this.playbackElement.classList.remove('hidden');
                        this.shareAudioButton.disabled = false;
                        this.shareImageButton.disabled = false;
                        this.downloadButton.disabled = false;
                        this.loadingIndicator.classList.remove('show');
                        
                        this.showSpeechBubble(this.translationElement.textContent);
                    };
                    
                    this.mediaRecorder.start();
                    this.recordButton.disabled = true;
                    this.stopButton.disabled = false;

                    this.audioVisualizerCanvas.classList.add('active');
                    this.drawAudioVisualizer();
                    
                    console.log('Recording started');
                } catch (error) {
                    console.error('Error starting recording:', error);
                    this.translationElement.textContent = 'Errore nella registrazione audio';
                    this.petAvatar.classList.remove('bounce');
                    if (this.audioContext) {
                        this.audioContext.close();
                        this.audioContext = null;
                    }
                    this.recordButton.disabled = false;
                    this.stopButton.disabled = true;
                    this.shareAudioButton.disabled = true;
                    this.shareImageButton.disabled = true;
                    this.downloadButton.disabled = true;
                }
            }
            
            stopRecording() {
                if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {
                    this.mediaRecorder.stop();
                    this.recordButton.disabled = false;
                    this.stopButton.disabled = true;
                    
                    this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                    
                    this.petAvatar.classList.remove('bounce');
                    cancelAnimationFrame(this.animationFrameId);
                    this.audioVisualizerCanvas.classList.remove('active');
                    
                    console.log('Recording stopped');
                }
            }

            drawAudioVisualizer() {
                const canvas = this.audioVisualizerCanvas;
                const ctx = this.audioVisualizerCtx;
                const WIDTH = canvas.width;
                const HEIGHT = canvas.height;

                const draw = () => {
                    this.animationFrameId = requestAnimationFrame(draw);

                    if (!this.analyserNode) return;

                    const bufferLength = this.analyserNode.fftSize;
                    const dataArray = new Uint8Array(bufferLength);
                    this.analyserNode.getByteTimeDomainData(dataArray);

                    ctx.clearRect(0, 0, WIDTH, HEIGHT);
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = 'var(--secondary-glow)';
                    ctx.beginPath();

                    const sliceWidth = WIDTH * 1.0 / bufferLength;
                    let x = 0;

                    for (let i = 0; i < bufferLength; i++) {
                        const v = dataArray[i] / 128.0;
                        const y = v * HEIGHT / 2;

                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }

                        x += sliceWidth;
                    }

                    ctx.lineTo(WIDTH, HEIGHT / 2);
                    ctx.stroke();

                    let sum = 0;
                    for (let i = 0; i < dataArray.length; i++) {
                        sum += dataArray[i];
                    }
                    const avg = sum / dataArray.length;
                    const scaleFactor = 1 + (avg / 255) * 0.2;
                    this.petAvatar.style.transform = `scale(${scaleFactor})`;
                };

                draw();
            }
            
            async processAudio() {
                if (!this.audioBuffer) {
                    this.translationElement.textContent = 'Errore di elaborazione audio';
                    return;
                }
                
                try {
                    const channelData = this.audioBuffer.getChannelData(0);
                    const bufferLength = channelData.length;

                    let sumOfSquares = 0;
                    let maxAmplitude = 0;
                    
                    for (let i = 0; i < bufferLength; i++) {
                        const sample = channelData[i];
                        sumOfSquares += sample * sample;
                        if (Math.abs(sample) > maxAmplitude) {
                            maxAmplitude = Math.abs(sample);
                        }
                    }
                    const averageEnergy = Math.sqrt(sumOfSquares / bufferLength);

                    let dominantFrequency = 0;
                    if (averageEnergy > 0.005) {
                        dominantFrequency = 200 + (averageEnergy * 1000);
                        dominantFrequency = Math.min(dominantFrequency, 2000);
                    }
                    
                    this.petType = (dominantFrequency > 500) ? 'cat' : 'dog';
                    
                    if (averageEnergy > 0.05 && dominantFrequency > 800) {
                        this.emotionalState = 'excited';
                    } else if (averageEnergy < 0.01 && dominantFrequency < 200) {
                        this.emotionalState = 'relaxed';
                    } else {
                        this.emotionalState = 'normal';
                    }

                    await this.applyVoiceEffect(this.currentVoice);
                    
                    const translation = this.generateTranslation(averageEnergy, dominantFrequency);
                    this.translationElement.textContent = translation;
                    
                    const now = new Date();
                    const petTypeEmoji = this.petType === 'cat' ? 'üê±' : 'üê∂';
                    this.translationMetaElement.textContent = `${petTypeEmoji} ‚Ä¢ ${now.toLocaleString()}`;
                    
                    this.updatePetAvatar();
                    this.showSpeechBubble(translation);
                    
                } catch (error) {
                    console.error('Error processing audio:', error);
                    this.translationElement.textContent = 'Errore di elaborazione audio';
                }
            }
            
            generateTranslation(energy, pitch) {
                const phrases = {
                    cat: {
                        excited: [
                            "Voglio le crocchette extra subito! üçñ",
                            "Ho visto un topo! Devo acchiapparlo! üê≠",
                            "Gioca con me adesso! üé£"
                        ],
                        normal: [
                            "Accarezzami proprio qui... ah s√¨! üòª",
                            "Fa un po' pi√π caldo oggi, vero? ‚òÄÔ∏è",
                            "Questo divano √® il mio posto preferito üõãÔ∏è"
                        ],
                        relaxed: [
                            "Zzz... sogni di topi giganti... üò¥",
                            "Cos√¨ comodo... non muovermi... üõèÔ∏è",
                            "Un altro pisolino non fa male... üí§"
                        ]
                    },
                    dog: {
                        excited: [
                            "√à ora di giocare! Lancia la palla! üéæ",
                            "Sono cos√¨ felice di vederti! ü•∞",
                            "Vado a prendere il bastone! üå≥"
                        ],
                        normal: [
                            "Ho fame! Dove sono i miei biscotti? üç™",
                            "Possiamo andare a fare una passeggiata? üö∂‚Äç‚ôÇÔ∏è",
                            "Mi gratti la pancia? √à il mio punto debole! ü§ó"
                        ],
                        relaxed: [
                            "Zzz... sogni ossa giganti... ü¶¥",
                            "Cos√¨ comodo sul mio tappeto... üêæ",
                            "Un altro pisolino prima di cena... üò¥"
                        ]
                    }
                };

                return phrases[this.petType][this.emotionalState][
                    Math.floor(Math.random() * phrases[this.petType][this.emotionalState].length)
                ];
            }
            
            updatePetAvatar() {
                this.petCore.style.background = 'radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%)';
                this.petCore.style.boxShadow = '0 0 25px var(--accent-glow)';
                this.petAura.style.borderColor = 'rgba(255,255,255,0.3)';
                this.petAura.style.animation = 'auraRotate 15s infinite linear';
                this.petAvatar.style.borderColor = 'var(--primary-glow)';
                this.petAvatar.style.boxShadow = '0 0 40px var(--primary-glow), inset 0 0 20px var(--primary-glow)';
                this.petAvatar.style.transform = 'scale(1)';
                
                if (this.petType === 'cat') {
                    this.petCore.style.background = 'radial-gradient(circle, #FFD3B6 0%, rgba(255,211,182,0) 70%)';
                    this.petCore.style.boxShadow = '0 0 30px #FFD3B6';
                } else {
                    this.petCore.style.background = 'radial-gradient(circle, #A8E6CF 0%, rgba(168,230,207,0) 70%)';
                    this.petCore.style.boxShadow = '0 0 30px #A8E6CF';
                }
                
                switch (this.currentVoice) {
                    case 'chipmunk':
                        this.petAvatar.style.transform = 'scale(0.9) rotate(10deg)';
                        this.petCore.style.boxShadow = '0 0 40px #FFD93D';
                        this.petAura.style.borderColor = '#FFD93D';
                        break;
                    case 'demon':
                        this.petAvatar.style.transform = 'scale(1.05)';
                        this.petCore.style.background = 'radial-gradient(circle, #C94C4C 0%, rgba(201,76,76,0) 70%)';
                        this.petCore.style.boxShadow = '0 0 40px #C94C4C';
                        this.petAura.style.borderColor = '#C94C4C';
                        this.petAvatar.style.borderColor = '#C94C4C';
                        break;
                    case 'robot':
                        this.petAvatar.style.transform = 'scale(1.02) rotate(-5deg)';
                        this.petCore.style.background = 'radial-gradient(circle, #B0E0E6 0%, rgba(176,224,230,0) 70%)';
                        this.petCore.style.boxShadow = '0 0 40px #B0E0E6';
                        this.petAura.style.borderColor = '#B0E0E6';
                        this.petAvatar.style.borderColor = '#B0E0E6';
                        break;
                    case 'echo':
                        this.petAvatar.style.boxShadow = '0 0 60px var(--secondary-glow), inset 0 0 30px var(--secondary-glow)';
                        this.petAvatar.style.borderColor = 'var(--secondary-glow)';
                        this.petAura.style.animation = 'auraRotate 8s infinite linear, corePulse 2s infinite alternate ease-in-out';
                        break;
                    case 'reverb':
                        this.petAvatar.style.background = 'radial-gradient(circle, #E6B6D3 0%, rgba(230,182,211,0) 70%)';
                        this.petAvatar.style.boxShadow = '0 0 60px #E6B6D3, inset 0 0 30px #E6B6D3';
                        this.petAvatar.style.borderColor = '#E6B6D3';
                        this.petAura.style.animation = 'auraRotate 20s infinite linear reverse, corePulse 3s infinite alternate ease-in-out';
                        break;
                }

                if (this.emotionalState === 'excited') {
                    this.petCore.style.animationDuration = '1.5s';
                    this.petAura.style.animationDuration = '8s';
                    this.petCore.style.boxShadow = `0 0 40px ${this.petType === 'cat' ? '#FFD3B6' : '#A8E6CF'}, 0 0 80px var(--accent-glow)`;
                } else if (this.emotionalState === 'relaxed') {
                    this.petCore.style.animationDuration = '5s';
                    this.petAura.style.animationDuration = '25s';
                    this.petCore.style.boxShadow = `0 0 15px ${this.petType === 'cat' ? '#FFD3B6' : '#A8E6CF'}`;
                } else {
                    this.petCore.style.animationDuration = '3s';
                    this.petAura.style.animationDuration = '15s';
                    this.petCore.style.boxShadow = `0 0 25px ${this.petType === 'cat' ? '#FFD3B6' : '#A8E6CF'}`;
                }
                
                this.petAvatar.classList.add('wiggle');
                setTimeout(() => this.petAvatar.classList.remove('wiggle'), 500);
            }
            
            showSpeechBubble(text) {
                this.speechBubble.textContent = text;
                this.speechBubble.classList.add('show');
                
                setTimeout(() => {
                    this.speechBubble.classList.remove('show');
                }, 3000);
            }
            
            async shareAudio() {
                if (!this.audioBlob) {
                    this.translationElement.textContent = 'Nessun audio da condividere';
                    return;
                }
                
                try {
                    const file = new File([this.audioBlob], 'pet_translation.wav', { type: 'audio/wav' });
                    if (navigator.share) {
                        await navigator.share({
                            files: [file],
                            title: 'PET SOUNDS - Traduzione Animale',
                            text: this.translationElement.textContent,
                        });
                    } else {
                        this.translationElement.textContent = 'Condivisione non supportata';
                    }
                } catch (error) {
                    console.error('Error sharing:', error);
                    this.translationElement.textContent = 'Condivisione annullata';
                }
            }

            async shareImage() {
                const translationText = this.translationElement.textContent;
                if (!translationText || translationText === 'Premi il pulsante di registrazione e lascia che il tuo animale parli!') {
                    this.translationElement.textContent = 'Nessuna traduzione da condividere';
                    return;
                }

                this.translationElement.textContent = 'Condivisione immagine in corso...';
                setTimeout(() => {
                    this.translationElement.textContent = translationText;
                    this.showSpeechBubble('Immagine condivisa con successo!');
                }, 2000);
            }

            downloadAudio() {
                if (!this.audioBlob) {
                    this.translationElement.textContent = 'Nessun audio da scaricare';
                    return;
                }
                
                const url = URL.createObjectURL(this.audioBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'pet-translation.wav';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                this.showSpeechBubble('Audio scaricato!');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            new PetVoiceTranslator();
        });
    </script>
</body>
</html>
